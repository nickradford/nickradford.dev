---
import Base from "../../layouts/BaseLayout.astro";
import BlogPage from "../../components/BlogPage.astro";
import { getCollection, getEntry } from "astro:content";
import { calculateReadingTime, toExcerpt } from "../../lib/content";

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntry("blog", slug);
const { Content } = await entry.render();
const readingTime = calculateReadingTime(entry.body);
---

<Base
  title={entry.data.title}
  og={`https://nickradford.dev/og/${slug}.png`}
  description={toExcerpt(entry.body)}
  type="article"
>
  <BlogPage
    meta={{
      title: entry.data.title,
      date: entry.data.date,
      slug: entry.slug,
      excerpt: "",
      readingTime,
    }}
  >
    <Content />
  </BlogPage>
</Base>
