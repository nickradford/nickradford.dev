---
export const prerender = true;
import Base from "../layouts/BaseLayout.astro";
import Text from "../components/Text.astro";
import Page from "../components/Page.astro";
import { DecodeText } from "../components/DecodeText";
import Frame from "src/components/Frame.astro";
import PageHeader from "src/components/PageHeader.astro";

import jobs from "../../jobs";

// Helper to format dates - show full date for first 2 items, year only for rest
const formatDate = (dateStr: string, index: number) => {
  if (index < 2) return dateStr;
  // Extract just the year (last 4 characters)
  return dateStr.split(" ").pop();
};

// Format the date range, collapsing if start and end year are the same
const formatDateRange = (startDate: string, endDate: string, index: number) => {
  const start = formatDate(startDate, index);
  const end = formatDate(endDate, index);

  // For newer items (with full dates), always show both
  if (index < 2) return `${start} — ${end}`;

  // For older items (year only), show just year if they match
  return start === end ? start : `${start} — ${end}`;
};
---

<Base title="Work" description="My professional experience and roles">
  <Page>
    <article class="border-l border-r border-orange/20 dark:border-zinc-800 w-full">
      {/* Header Section */}
      <PageHeader>
        <div
          slot="title"
          class="flex flex-col md:flex-row md:items-center md:justify-between gap-6"
        >
          <DecodeText
            client:load
            value="work"
            className="text-4xl md:text-5xl font-geist-mono font-bold tracking-tight leading-tight text-zinc-900 dark:text-zinc-50"
          />
          <a
            href="/nick-radford-resume-2025-10-30.pdf"
            download="Nick-Radford-Resume.pdf"
            class="inline-flex items-center gap-2 px-6 py-3 text-sm font-geist-mono font-medium text-zinc-900 bg-orange hover:bg-orange/90 transition-colors whitespace-nowrap flex-shrink-0 squircle"
            data-umami-event="Download Resume"
            data-umami-event-resume-version="nick-radford-resume-2025-10-30.pdf"
          >
            Download resume <i class="ph ph-file-pdf text-lg"></i>
          </a>
        </div>
        <Text slot="description">
          Want the full picture? Download my resume for a comprehensive look at my experience, key
          projects, achievements, and technical expertise.
        </Text>
      </PageHeader>

      {/* Jobs Grid */}
      <div class="w-full flex flex-col space-y-0 divide-y divide-orange/20 dark:divide-zinc-800">
        {
          jobs.map((job, index) => (
            <div class="flex flex-col md:flex-row md:divide-x divide-orange/20 dark:divide-zinc-800 relative">
              <div class="hidden md:flex flex-1" />
              <div class="max-w-4xl w-full px-8 md:px-16 py-4 md:py-6 group relative">
                <div class="flex gap-6">
                  {/* Logo */}
                  <div class="flex-none">
                    <div class="relative w-12 h-12 squircle overflow-hidden bg-zinc-100 dark:bg-zinc-900 ring-1 ring-zinc-200 dark:ring-zinc-800 flex items-center justify-center">
                      <img
                        src={(job.img as any).src || job.img}
                        alt={job.company}
                        class="w-full h-full object-cover transition-all ease-in duration-300"
                      />
                    </div>
                  </div>

                  {/* Content */}
                  <div class="flex-1 min-w-0">
                    <div class="space-y-2">
                      <div class="flex flex-col md:flex-row md:items-baseline md:justify-between gap-2">
                        <div class="space-y-1">
                          <h3 class="text-base font-geist-mono font-bold text-zinc-900 dark:text-zinc-50 group-hover:text-orange dark:group-hover:text-orange transition-colors ease-in duration-300">
                            {job.company}
                            {job.extraInfo && (
                              <span class="text-xs font-normal text-zinc-500 dark:text-zinc-400 ml-2">
                                ({job.extraInfo})
                              </span>
                            )}
                          </h3>
                          <p class="text-xs font-geist-mono text-zinc-700 dark:text-zinc-300">
                            {job.role}
                          </p>
                        </div>
                        <time class="text-xs font-geist-mono uppercase tracking-wide text-zinc-500 dark:text-zinc-500 whitespace-nowrap">
                          {formatDateRange(job.startDate, job.endDate, index)}
                        </time>
                      </div>
                    </div>
                  </div>
                </div>
                <Frame bottom={index === jobs.length - 1} />
              </div>
              <div class="hidden md:flex flex-1" />
            </div>
          ))
        }
      </div>
    </article>
  </Page>
</Base>
