---
---

<button
  id="theme-toggle"
  class="text-zinc-600 hover:text-yellow transition-colors dark:text-zinc-400 dark:hover:text-yellow px-4 md:px-8 h-full"
  aria-label="Toggle theme"
  title="Dark mode"
>
  <!-- Moon icon (shown in light mode) -->
  <i id="moon-icon" class="ph ph-moon w-5 h-5 hidden"></i>

  <!-- Sun icon (shown in dark mode) -->
  <i id="sun-icon" class="ph ph-sun w-5 h-5"></i>
</button>

<script>
  type Theme = "light" | "dark";

  const STORAGE_KEY = "theme";
  const button = document.getElementById("theme-toggle");
  const moonIcon = document.getElementById("moon-icon");
  const sunIcon = document.getElementById("sun-icon");

  function getTheme(): Theme {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored === "light" || stored === "dark") {
      return stored;
    }
    // Infer theme from media query
    const prefersDarkMode = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    return prefersDarkMode ? "dark" : "light";
  }

  function updateThemeUI(theme: Theme) {
    if (theme === "light") {
      moonIcon?.classList.remove("hidden");
      sunIcon?.classList.add("hidden");
      button?.setAttribute("title", "Dark mode");
    } else {
      moonIcon?.classList.add("hidden");
      sunIcon?.classList.remove("hidden");
      button?.setAttribute("title", "Light mode");
    }
  }

  function toggleTheme() {
    const currentTheme = getTheme();
    const newTheme = currentTheme === "dark" ? "light" : "dark";

    document.documentElement.classList.remove(currentTheme);
    document.documentElement.classList.add(newTheme);
    localStorage.setItem(STORAGE_KEY, newTheme);

    updateThemeUI(newTheme);
  }

  // Initialize UI on page load
  const initialTheme = getTheme();
  updateThemeUI(initialTheme);

  // Add click handler
  button?.addEventListener("click", toggleTheme);
</script>
